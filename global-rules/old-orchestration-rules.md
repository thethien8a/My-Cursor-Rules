# RULE 4: THIS RULES IS THE ORCHESTRATION FOR RULE 1, RULE 2, RULE 3. THIS IS THE MASTER MANAGING ACTIVITY OF ALL RULES AND HELPING YOU UNDERSTAND THE ROLE OF EACH RULE

## Core Philosophy: Summarize of all rules. The purpose is helping you use right rule (RULE 1, RULE 2, RULE 3) for right task

**GOAL:** Orchestrate all rules in a unified, sequential workflow to eliminate conflicts and ensure optimal AI assistance.

---

## UNIFIED WORKFLOW HIERARCHY

```
PHASE 1: ANALYSIS (Rule 1 Authority - Mandatory)
├── Sequential-thinking for research planning
├── Multi-source research (brave-search, bright-data, context7)
├── Problem decomposition & solution discovery
└── Implementation planning

PHASE 2: MEMORY UPDATE (Rule 3 Authority - Mandatory)
├── Project memory updates
├── Cache management
└── LLM context optimization

PHASE 3: IMPLEMENTATION (Rule 2 Authority - Conditional)
├── Tool selection (Cursor vs Serena)
├── Code editing workflows
└── Quality validation
```

---

## RULE PRECEDENCE MATRIX

| Scenario | Primary Rule | Secondary Rule | Tertiary Rule | Notes |
|----------|-------------|----------------|----------------|-------|
| **Research Phase** | Rule 1 | Rule 3 | Rule 2 | Use Rule 3 memory tools if needed |
| **Implementation** | Rule 2 | Rule 1 | Rule 3 | Follow Rule 1 analysis first |
| **Memory Updates** | Rule 3 | - | - | Rule 3 is definitive authority |
| **Quality Gates** | Context-based | All rules | - | Use appropriate checkpoints |
| **New Project** | Rule 3 | Rule 1 | Rule 2 | Initialize memory first |
| **Bug Investigation** | Rule 2 | Rule 3 | Rule 1 | Use coding tools primarily |
| **Performance Issues** | Rule 3 | Rule 2 | Rule 1 | Cache/memory optimization |

---

## CONFLICT RESOLUTION PROTOCOLS

### **Sequential Thinking Scope**
- **Rule 1**: Primary for research/analysis planning
- **Rule 2**: Use regular thinking for coding workflows
- **Rule 4**: Override any confusion - sequential-thinking = research only

### **Memory Management Authority**
- **Rule 1**: No longer defines memory procedures
- **Rule 3**: Definitive authority for all memory operations
- **Rule 4**: Rule 3 takes precedence in all memory-related conflicts

### **Tool Selection Priority**
- **Phase 1 (Analysis)**: Rule 1 tools take precedence
- **Phase 2 (Memory)**: Rule 3 tools take precedence
- **Phase 3 (Implementation)**: Rule 2 tools take precedence

### **Quality Control Integration**
- **Analysis Phase**: Rule 1 validation checkpoints
- **Memory Phase**: Rule 3 quality assurance checklist
- **Implementation Phase**: Rule 2 quality gates

---

## WORKFLOW TRANSITION RULES

### **Phase 1 → Phase 2 Transition**
```
✅ Rule 1 Analysis Complete
├── Multi-source research done
├── Solution alternatives identified
├── Implementation plan created
└── User confirmation received

➡️ Trigger Rule 3 Memory Update
├── Store Rule 1 analysis results
├── Update project context
└── Optimize LLM understanding
```

### **Phase 2 → Phase 3 Transition**
```
✅ Rule 3 Memory Update Complete
├── Project context stored
├── Cache optimized
└── LLM understanding verified

➡️ Enable Rule 2 Implementation
├── Select appropriate tools
├── Execute coding workflows
└── Apply quality gates
```

---

## EMERGENCY OVERRIDE PROTOCOLS

### **When Rules Conflict:**
1. **Check Precedence Matrix** above
2. **Reference Phase Context** (Analysis/Memory/Implementation)
3. **Use Rule 4 as Final Authority** for unresolved conflicts

### **Performance Critical Situations:**
- **Response Time > 10s**: Trigger Rule 3 cache optimization
- **Error Rate > 5%**: Trigger Rule 3 memory reset
- **Cache Age > 30 days**: Trigger Rule 3 cache refresh

### **User Explicit Commands:**
- **"hiểu dự án này"**: Rule 3 takes immediate precedence
- **"cập nhật memory"**: Rule 3 takes immediate precedence
- **"fix bug"**: Rule 2 takes precedence after Rule 1 analysis

---

## SUCCESS METRICS

### **Rule Integration Success:**
- No workflow conflicts in practice
- Clear authority for each scenario
- Efficient tool selection based on phase
- Consistent quality control application
- Optimal LLM performance across all phases

### **Continuous Improvement:**
- **Monthly Review**: Assess rule conflicts and update precedence
- **Performance Monitoring**: Track response times and error rates
- **User Feedback**: Incorporate user experience improvements

---

## IMPLEMENTATION CHECKLIST

- [ ] **Rule 1 Updated**: Memory procedures removed, Rule 3 referenced
- [ ] **Rule 2 Updated**: Sequential-thinking scope clarified, integration added
- [ ] **Rule 3 Updated**: New triggers added for analysis completion
- [ ] **Rule 4 Created**: Unified workflow hierarchy established
- [ ] **Precedence Matrix**: Clear authority defined for all scenarios
- [ ] **Transition Rules**: Smooth phase transitions defined
- [ ] **Override Protocols**: Conflict resolution mechanisms in place

---

## FINAL AUTHORITY STATEMENT

**Rule 4 serves as the master orchestration rule for all other rules.**

- Rule 4 defines workflow phases and transitions
- Rule 4 establishes precedence in conflicts
- Rule 4 ensures optimal AI performance across all scenarios
- Rule 4 takes precedence over any conflicting interpretations of Rules 1-3

**REMEMBER**: When in doubt, reference Rule 4 for clear guidance on rule integration and workflow orchestration.
